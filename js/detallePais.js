import{mostrarSpinner,limpiarHTML,lightMode,darkMode,activarModoOscuro}from"./funciones.js";import{d,ls,$darkBtn,$loader,$detailCountry,searchParagram}from"./variables.js";let darkModeTheme=!1;async function buscarPais(e){mostrarSpinner(darkModeTheme,$detailCountry);try{const t=await fetch(e);return await t.json()}catch(e){console.log(e)}}async function dibujarHTML(e){limpiarHTML($detailCountry);const{flag:t,name:a,nativeName:n,population:r,region:s,subregion:o,capital:i,topLevelDomain:c,currencies:l,languages:m,borders:p}=e;let u=c.reduce((e,t)=>e+", "+t),h="",g="";l.forEach(e=>h+=", "+e.name),m.forEach(e=>g+=", "+e.name),g=g.slice(2)+".",h=h.slice(2)+".";const f=d.createDocumentFragment(),M=d.createElement("img"),b=d.createElement("section"),L=d.createElement("h1"),y=d.createElement("div"),C=d.createElement("div"),$=d.createElement("section"),k=d.createElement("h2"),E=d.createElement("div");b.classList.add("detail-info"),L.classList.add("mt-1"),y.classList.add("info","mt-2","mt-lg-0"),C.classList.add("info-2","mt-2","mt-lg-0"),$.classList.add("border-countries"),$.setAttribute("data-dark",""),k.classList.add("mt-2","mt-lg-0"),E.classList.add("border-countries-btn","flex","mt-1","mt-lg-0"),M.src=t,M.alt=`Bandera de ${a}`,L.textContent=a,y.innerHTML=`\n    <p class="py-0-5"><strong>Native Name: </strong>${n}</p>\n    <p class="py-0-5"><strong>Population: </strong>${Intl.NumberFormat("de-DE").format(r)}</p>\n    <p class="py-0-5"><strong>Region: </strong>${s}</p>\n    <p class="py-0-5"><strong>Sub Region: </strong>${o}</p>\n    <p class="py-0-5"><strong>Capital: </strong>${i}</p>\n  `,C.innerHTML=`\n    <p class="py-0-5"><strong>Top Level Domain: </strong>${u}</p>\n    <p class="py-0-5"><strong>Currencies: </strong>${h}</p>\n    <p class="py-0-5"><strong>Languages: </strong>${g}</p>\n  `,k.textContent="Border Countries",(await buscarNombres(p)).forEach(e=>{const t=d.createElement("a");t.href="#",t.textContent=e,t.classList.add("w-30","mr-0-5","text-center","mt-1","px-lg-1"),darkModeTheme&&t.classList.add("dark-mode-card"),t.setAttribute("data-dark-card",""),t.onclick=(async()=>{const t=`https://restcountries.eu/rest/v2/name/${e}?fullText=true`;dibujarHTML(...await buscarPais(t))}),E.appendChild(t)}),b.appendChild(L),b.appendChild(y),b.appendChild(C),$.appendChild(k),$.appendChild(E),b.appendChild($),f.appendChild(M),f.appendChild(b),$loader.style.display="none",$detailCountry.appendChild(f)}async function buscarNombres(e){const t=[];let a="https://restcountries.eu/rest/v2/alpha?codes=";e.forEach(e=>a+=e+";");try{const e=await fetch(a);(await e.json()).forEach(e=>t.push(e.name))}catch(e){}return t}function cambioModo(){darkModeTheme=activarModoOscuro(darkModeTheme)}d.addEventListener("DOMContentLoaded",async e=>{null===ls.getItem("theme")&&ls.setItem("theme","light"),"light"===ls.getItem("theme")&&(darkModeTheme=lightMode()),"dark"===ls.getItem("theme")&&(darkModeTheme=darkMode());const t=`https://restcountries.eu/rest/v2/name/${searchParagram.get("pais")}?fullText=true`;dibujarHTML(...await buscarPais(t))}),$darkBtn.addEventListener("click",cambioModo);