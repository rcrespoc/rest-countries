import{mostrarSpinner,limpiarHTML,lightMode,darkMode,activarModoOscuro,crearPaginador,mostrarError}from"./funciones.js";import{d,ls,$darkBtn,$loader,$mainContent,$paginacionDiv,$inputCountry,$selectCountries}from"./variables.js";let totalPaginas,url="https://restcountries.eu/rest/v2/all",numXPagina=8;numXPagina=window.matchMedia("(min-width: 80rem)").matches?8:window.matchMedia("(min-width: 64rem)").matches?9:8;let paginaActual=1,inicio=0,fin=inicio+numXPagina,darkModeTheme=!1;async function cargarPaises(a,e,t){mostrarSpinner(darkModeTheme,$mainContent);try{const n=await fetch(t),i=await n.json();404===i.status?(totalPaginas=1,mostrarError($mainContent),limpiarHTML($paginacionDiv),imprimirPaginador()):(totalPaginas=Math.ceil(i.length/numXPagina),mostrarDatos(i.slice(a,e)))}catch(a){console.log(a)}}function mostrarDatos(a){limpiarHTML($mainContent);const e=d.createDocumentFragment();a.forEach(a=>{const{name:t,population:n,region:i,capital:r}=a,o=d.createElement("div"),s=d.createElement("a"),l=d.createElement("img"),m=d.createElement("section");s.dataset.pais=t,s.href=`detallePais.html?pais=${t}`,o.classList.add("card","bg-white-1"),o.setAttribute("data-dark-card",""),darkModeTheme&&o.classList.add("dark-mode-card"),m.classList.add("country-info","p-1-5"),m.innerHTML=`\n    <h4 class="mb-1">${t}</h4>\n    <small><strong>Population: </strong> ${Intl.NumberFormat("de-DE").format(n)}</small><br>\n    <small><strong>Region: </strong> ${i}</small><br>\n    <small><strong>Capital: </strong> ${r}</small><br>\n    `,l.src=a.flag,l.alt=`Bandera de ${t}`,s.appendChild(l),o.appendChild(s),o.appendChild(m),e.appendChild(o)}),$loader.style.display="none",$mainContent.appendChild(e),limpiarHTML($paginacionDiv),imprimirPaginador()}function imprimirPaginador(){let a=crearPaginador(totalPaginas);const e=d.createDocumentFragment();let t=!1;for(;!t;){const{value:n,done:i}=a.next();if(i)t=!0;else{const a=document.createElement("a");a.href="#",a.dataset.pagina=n,a.textContent=n,a.classList.add("btn"),a.onclick=(a=>{t=(inicio=((paginaActual=n)-1)*numXPagina)+numXPagina,limpiarHTML($mainContent),mostrarSpinner(darkModeTheme,$mainContent),cargarPaises(inicio,t,url)}),e.appendChild(a)}}$paginacionDiv.appendChild(e)}function cambioModo(){darkModeTheme=activarModoOscuro(darkModeTheme)}d.addEventListener("DOMContentLoaded",a=>{null===ls.getItem("theme")&&ls.setItem("theme","light"),"light"===ls.getItem("theme")&&(darkModeTheme=!1,lightMode()),"dark"===ls.getItem("theme")&&(darkModeTheme=!0,darkMode()),cargarPaises(inicio,fin,url)}),$darkBtn.addEventListener("click",cambioModo),$selectCountries.addEventListener("change",a=>{url=`https://restcountries.eu/rest/v2/region/${a.target.value}`,cargarPaises(inicio=0,fin,url)}),$inputCountry.addEventListener("input",a=>{a.target.value.match(/[a-zA-Z]/)&&(url=0===a.target.length?"https://restcountries.eu/rest/v2/name/all":`https://restcountries.eu/rest/v2/name/${a.target.value}`,cargarPaises(inicio=0,fin,url))});